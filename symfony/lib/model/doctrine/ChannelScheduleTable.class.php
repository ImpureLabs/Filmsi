<?php

/**
 * ChannelScheduleTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ChannelScheduleTable extends Doctrine_Table
{
	public static function getInstance()
	{
		return Doctrine_Core::getTable('ChannelSchedule');
	}

	public function getFilmCountByChannel($channelId)
	{
		$q = Doctrine_Query::create()
			->select('COUNT(s.id) count')
			->from('ChannelSchedule s')
			->where('s.channel_id = ?', $channelId)
			->fetchOne(array(), Doctrine_Core::HYDRATE_ARRAY);

		return $q['count'];
	}

	public function getDetailedByChannel($channelId)
	{
		$scheduleBrutes = Doctrine_Query::create()
			->from('ChannelSchedule cs')
			->innerJoin('cs.Film f')
			->innerJoin('cs.Channel c')
			->where('cs.channel_id = ?', $channelId)
			->orderBy('cs.day, cs.time_from ASC')
			->execute();

		$schedules = array();
		foreach ($scheduleBrutes as $scheduleBrute){
			$schedules[$scheduleBrute->getDay()][] = array(
				'id' => $scheduleBrute->getId(),
				'film' => $scheduleBrute->getFilm()->getName(),
				'time_from' => $scheduleBrute->getTimeFrom(),
				'time_to' => $scheduleBrute->getTimeTo()
			);
		}

		return $schedules;
	}
}